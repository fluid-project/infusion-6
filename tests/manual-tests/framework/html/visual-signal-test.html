<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Visual Signals Tests</title>

    <style>
        body, button, input, select, textarea {
            font-family: BlinkMacSystemFont, -apple-system, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
        }
    </style>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>

    <script src="../../../../src/lib/codemirror/js/codemirror.js"></script>
    <script src="../../../../src/lib/codemirror/js/javascript.js"></script>

    <link rel="stylesheet" media="screen" href="../../../../src/lib/codemirror/css/codemirror.css"></link>

    <script src="../../../../src/lib/lezer/lezer-javascript-browser.js"></script>

    <script src="../../../../src/framework/core/js/FluidCore.js"></script>
    <script src="../../../../src/framework/core/js/FluidSignals.js"></script>
    <script src="../../../../src/framework/core/js/FluidDebugging.js"></script>

    <script src="../../../test-core/qunit/js/lezer-transform.js"></script>
    <script src="../../../test-core/qunit/js/qunit-visual-signals-2.js"></script>

    <link rel="stylesheet" media="screen" href="../../../test-core/qunit/css/qunit-visual-signals.css" />

</head>
<body>
<main>
    <h1>Visual Signals Test</h1>

    <div class="vizreactive-target">
        <span class="vizreactive-testname">preact-signals: Should drop A->B->A updates</span>
        <pre class="vizreactive-source">
assert => {
    //     A
    //   / |
    //  B  | <- Looks like a flag doesn't it? :D
    //   \ |
    //     C
    //     |
    //     D
    const a = fluid.cell(2);

    const b = fluid.cell().computed(aVal => aVal - 1, [a]);

    const c = fluid.cell().computed((aVal, bVal) => aVal + bVal, [a, b]);

    let computeCount = 0;

    const d = fluid.cell().computed(
        cVal => {
            computeCount++;
            return "d: " + cVal;
        },
        [c]
    );

    // Trigger read
    assert.equal(d.get(), "d: 3");
    assert.equal(computeCount, 1);
    computeCount = 0;

    a.set(4);
    d.get();
    assert.equal(computeCount, 1);
}
        </pre>
    </div>

    <script>
        fluid.vizReactive.bootVizReactiveUI();
    </script>
</main>

</body>
</html>
